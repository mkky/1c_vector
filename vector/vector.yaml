timezone: Europe/Moscow

api:
  enabled: true

sources:
  lgp_logs:
    type: file
    include:
      - "/var/log/**/1Cv8Log/*.lgp"
    fingerprint:
      strategy: device_and_inode
    multiline:
      start_pattern: "^\\{\\d{14},\\w,"  
      condition_pattern: "^\\{\\d{14},\\w,"
      mode: halt_before      
      timeout_ms: 1000


transforms:
  parse_lgp:
    reroute_dropped: true
    inputs:
      - lgp_logs
    type: remap
    file: /etc/vector/transforms/parseLgp.vrl


sinks:
  # out:
    # type: file
    # inputs:
      # - parse_lgp
    # encoding:
       # codec: json
    # path: "/etc/vector/lgp.json"

  # D:
    # type: file
    # inputs:
      # - parse_lgp.dropped
    # encoding:
       # codec: json
    # path: "/etc/vector/lgp-dropped.json"


  clickhouse:
    type: clickhouse
    inputs:
      - parse_lgp
    endpoint: ${CLICKHOUSE_SERVER}
    auth:
      strategy: basic
      user: ${CLICKHOUSE_USER}
      password: ${CLICKHOUSE_PASSWORD}
    database: ${CLICKHOUSE_DATABASE}
    skip_unknown_fields: true
    table: "{{ .name }}"
    batch:
      max_events: 10000
      timeout_secs: 5
    acknowledgements:
      enabled: true


    
enrichment_tables:
  ibases:
    type: file
    file:
      path: "/etc/vector/csv_transforms/tables/ibases.csv"
      encoding:
        type: "csv"
    schema:
      ID: "string"
      name: "string"    
      
      
  lgf:
    type: file
    file:
      path: "/etc/vector/csv_transforms/tables/lgf.csv"
      encoding:
        type: "csv"
    schema:
      type: "string"
      db_uid: "string" 
      id: "string" 
      value: "string" 
      uuid: "string" 

